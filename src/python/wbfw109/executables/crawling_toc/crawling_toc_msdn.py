from typing import Optional, Union

from bs4 import BeautifulSoup
from bs4.element import NavigableString, Tag


def format_toc_msdn(xml_input: str) -> None:
    """Depth-First Search (DFS) üìÖ 2024-09-02 05:13:55"""
    soup: BeautifulSoup = BeautifulSoup(xml_input, "html.parser")

    def process_element(element: Union[Tag, NavigableString], depth: int = 0) -> None:
        indentation: str = "  " * depth

        if isinstance(element, Tag):
            href: Optional[str] = None
            if element.name == "a":
                # Handle href that could be either a str or a list[str]
                href_value = element.get("href")
                if isinstance(href_value, list):
                    href = href_value[0]  # If it's a list, take the first element
                elif isinstance(href_value, str):
                    href = href_value

                if href:
                    text: str = element.get_text(strip=True)
                    print(f"{indentation}‚öì {text} ; {href}")

            elif element.name == "span" and element.get_text(strip=True):
                text: str = element.get_text(strip=True)
                print(f"\n\n{indentation}# {text}")

            # Process children elements recursively         ### üö£ recursive=False
            children: list[Tag] = element.find_all(["li", "a", "span"], recursive=False)
            for child in children:
                ## There are no nested li elements in Table of Contents in MSDN.
                if child.name == "li":
                    nested_a = child.find("a", recursive=False)
                    if isinstance(nested_a, Tag):
                        process_element(nested_a, depth)

                    nested_span = child.find("span", recursive=False)
                    if isinstance(nested_span, Tag):
                        process_element(nested_span, depth)

                    nested_ul = child.find("ul", recursive=False)
                    if isinstance(nested_ul, Tag):
                        process_element(nested_ul, depth + 1)
                elif child.name in ["a", "span"]:
                    process_element(child, depth)

    # Find the top-level 'ul' by filtering all 'ul' elements for the correct class
    top_level_ul: Optional[Tag] = next(
        (
            ul
            for ul in soup.find_all("ul")
            if isinstance(ul, Tag)
            and "table-of-contents" in (ul.get("class") or [])  ##### üí°
        ),
        None,
    )

    if top_level_ul:
        process_element(top_level_ul)
    else:
        print("Top-level <ul> with class 'table-of-contents' not found.")


# üìù Read XML input from your hardcoded input
if __name__ == "__main__":
    xml_input = """
    <ul class="tree table-of-contents is-vertically-scrollable flex-grow-1 flex-shrink-1" role="tree" aria-label="Table of contents" data-bi-name="tree" data-is-collapsible="true"><li role="none"><a aria-setsize="11" aria-level="1" aria-posinset="1" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator is-selected" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/cpp-standard-library-reference?view=msvc-170" aria-current="page">C++ Standard Library reference</a></li><li class="tree-item" aria-setsize="11" aria-level="1" aria-posinset="2" role="treeitem" tabindex="-1" id="title-2-1" aria-expanded="false"><span data-bi-name="tree-expander" class="tree-expander"><span class="tree-expander-indicator docon docon-chevron-right-light" aria-hidden="true"></span>C++ Standard Library header files</span></li><li class="tree-item" aria-setsize="11" aria-level="1" aria-posinset="3" role="treeitem" tabindex="-1" id="title-3-1" aria-expanded="false"><span data-bi-name="tree-expander" class="tree-expander"><span class="tree-expander-indicator docon docon-chevron-right-light" aria-hidden="true"></span>C++ Standard Library overview</span></li><li class="tree-item" aria-setsize="11" aria-level="1" aria-posinset="4" role="treeitem" tabindex="-1" id="title-4-1" aria-expanded="false"><span data-bi-name="tree-expander" class="tree-expander"><span class="tree-expander-indicator docon docon-chevron-right-light" aria-hidden="true"></span>C++ Standard Library containers</span></li><li role="none"><a aria-setsize="11" aria-level="1" aria-posinset="5" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/iterators?view=msvc-170">Iterators</a></li><li role="none"><a aria-setsize="11" aria-level="1" aria-posinset="6" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/algorithms?view=msvc-170">Algorithms</a></li><li role="none"><a aria-setsize="11" aria-level="1" aria-posinset="7" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/allocators?view=msvc-170">Allocators</a></li><li role="none"><a aria-setsize="11" aria-level="1" aria-posinset="8" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/function-objects-in-the-stl?view=msvc-170">Function objects in the C++ Standard Library</a></li><li class="tree-item is-expanded" aria-setsize="11" aria-level="1" aria-posinset="9" role="treeitem" tabindex="-1" id="title-9-1" aria-expanded="true"><span data-bi-name="tree-expander" class="tree-expander"><span class="tree-expander-indicator docon docon-chevron-right-light" aria-hidden="true"></span>iostream programming</span><ul class="tree-group" role="group"><li role="none"><a aria-setsize="8" aria-level="2" aria-posinset="1" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/iostream-programming?view=msvc-170">iostream programming</a></li><li role="none"><a aria-setsize="8" aria-level="2" aria-posinset="2" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/text/string-and-i-o-formatting-modern-cpp?view=msvc-170">String and I/O formatting</a></li><li class="tree-item is-expanded" aria-setsize="8" aria-level="2" aria-posinset="3" role="treeitem" tabindex="0" id="title-9-1_3-2" aria-expanded="true"><span data-bi-name="tree-expander" class="tree-expander"><span class="tree-expander-indicator docon docon-chevron-right-light" aria-hidden="true"></span>What a stream is</span><ul class="tree-group" role="group"><li role="none"><a aria-setsize="2" aria-level="3" aria-posinset="1" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/what-a-stream-is?view=msvc-170">What a stream is</a></li><li role="none"><a aria-setsize="2" aria-level="3" aria-posinset="2" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/input-output-alternatives?view=msvc-170">Input-output alternatives</a></li></ul></li><li class="tree-item is-expanded" aria-setsize="8" aria-level="2" aria-posinset="4" role="treeitem" tabindex="-1" id="title-9-1_4-2" aria-expanded="true"><span data-bi-name="tree-expander" class="tree-expander"><span class="tree-expander-indicator docon docon-chevron-right-light" aria-hidden="true"></span>Output streams</span><ul class="tree-group" role="group"><li role="none"><a aria-setsize="8" aria-level="3" aria-posinset="1" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/output-streams?view=msvc-170">Output streams</a></li><li role="none"><a aria-setsize="8" aria-level="3" aria-posinset="2" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/constructing-output-stream-objects?view=msvc-170">Constructing output stream objects</a></li><li role="none"><a aria-setsize="8" aria-level="3" aria-posinset="3" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/using-insertion-operators-and-controlling-format?view=msvc-170">Using insertion operators and controlling format</a></li><li role="none"><a aria-setsize="8" aria-level="3" aria-posinset="4" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/output-file-stream-member-functions?view=msvc-170">Output file stream member functions</a></li><li role="none"><a aria-setsize="8" aria-level="3" aria-posinset="5" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/effects-of-buffering?view=msvc-170">Effects of buffering</a></li><li role="none"><a aria-setsize="8" aria-level="3" aria-posinset="6" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/binary-output-files?view=msvc-170">Binary output files</a></li><li role="none"><a aria-setsize="8" aria-level="3" aria-posinset="7" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/overloading-the-output-operator-for-your-own-classes?view=msvc-170">Overloading the &lt;&lt; operator for your own classes</a></li><li role="none"><a aria-setsize="8" aria-level="3" aria-posinset="8" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/writing-your-own-manipulators-without-arguments?view=msvc-170">Writing your own manipulators without arguments</a></li></ul></li><li class="tree-item is-expanded" aria-setsize="8" aria-level="2" aria-posinset="5" role="treeitem" tabindex="-1" id="title-9-1_5-2" aria-expanded="true"><span data-bi-name="tree-expander" class="tree-expander"><span class="tree-expander-indicator docon docon-chevron-right-light" aria-hidden="true"></span>Input streams</span><ul class="tree-group" role="group"><li role="none"><a aria-setsize="7" aria-level="3" aria-posinset="1" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/input-streams?view=msvc-170">Input streams</a></li><li role="none"><a aria-setsize="7" aria-level="3" aria-posinset="2" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/constructing-input-stream-objects?view=msvc-170">Constructing input stream objects</a></li><li role="none"><a aria-setsize="7" aria-level="3" aria-posinset="3" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/using-extraction-operators?view=msvc-170">Using extraction operators</a></li><li role="none"><a aria-setsize="7" aria-level="3" aria-posinset="4" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/testing-for-extraction-errors?view=msvc-170">Testing for extraction errors</a></li><li role="none"><a aria-setsize="7" aria-level="3" aria-posinset="5" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/input-stream-manipulators?view=msvc-170">Input stream manipulators</a></li><li role="none"><a aria-setsize="7" aria-level="3" aria-posinset="6" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/input-stream-member-functions?view=msvc-170">Input stream member functions</a></li><li role="none"><a aria-setsize="7" aria-level="3" aria-posinset="7" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/overloading-the-input-operator-for-your-own-classes?view=msvc-170">Overloading the &gt;&gt; operator for your own classes</a></li></ul></li><li role="none"><a aria-setsize="8" aria-level="2" aria-posinset="6" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/input-output-streams?view=msvc-170">Input-output streams</a></li><li role="none"><a aria-setsize="8" aria-level="2" aria-posinset="7" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/iostreams-conventions?view=msvc-170">iostreams conventions</a></li><li class="tree-item is-expanded" aria-setsize="8" aria-level="2" aria-posinset="8" role="treeitem" tabindex="-1" id="title-9-1_8-2" aria-expanded="true"><span data-bi-name="tree-expander" class="tree-expander"><span class="tree-expander-indicator docon docon-chevron-right-light" aria-hidden="true"></span>Custom manipulators with arguments</span><ul class="tree-group" role="group"><li role="none"><a aria-setsize="3" aria-level="3" aria-posinset="1" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/custom-manipulators-with-arguments?view=msvc-170">Custom manipulators with arguments</a></li><li role="none"><a aria-setsize="3" aria-level="3" aria-posinset="2" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/output-stream-manipulators-with-one-argument-int-or-long?view=msvc-170">Output stream manipulators with one argument (int or long)</a></li><li role="none"><a aria-setsize="3" aria-level="3" aria-posinset="3" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/other-one-argument-output-stream-manipulators?view=msvc-170">Other one-argument output stream manipulators</a></li></ul></li></ul></li><li role="none"><a aria-setsize="11" aria-level="1" aria-posinset="10" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/regular-expressions-cpp?view=msvc-170">Regular expressions (C++)</a></li><li role="none"><a aria-setsize="11" aria-level="1" aria-posinset="11" role="treeitem" tabindex="-1" class="tree-item is-leaf has-external-link-indicator" data-bi-name="tree-leaf" href="https://learn.microsoft.com/en-us/cpp/standard-library/file-system-navigation?view=msvc-170">File system navigation</a></li></ul>
    """
    format_toc_msdn(xml_input)
